
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A guided introduction to Dyalog APL">
      
      
      
        <link rel="canonical" href="https://dyalog.com/Interpreter-internals/">
      
      <link rel="icon" href="../img/favicon-32.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.1">
    
    
      
        <title>Interpreter Internals - APL Course</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../style/main.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#interpreter-internals" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="APL Course" class="md-header__button md-logo" aria-label="APL Course" data-md-component="logo">
      
  <img src="../img/dyalog-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            APL Course
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Interpreter Internals
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="APL Course" class="md-nav__button md-logo" aria-label="APL Course" data-md-component="logo">
      
  <img src="../img/dyalog-white.svg" alt="logo">

    </a>
    APL Course
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../First-steps/" class="md-nav__link">
        First Steps
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Dfns/" class="md-nav__link">
        Dfns and Assignment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Selecting-from-lists/" class="md-nav__link">
        Selecting from Lists
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Outer-product/" class="md-nav__link">
        The Outer Product
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Shape-Reshape/" class="md-nav__link">
        Shape Reshape
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Array-model/" class="md-nav__link">
        The Array Model
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Selecting-from-arrays/" class="md-nav__link">
        Search, Sort and Select
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Loops/" class="md-nav__link">
        Loops and Recursion
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Assignment/" class="md-nav__link">
        Extra Assignment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Workspaces/" class="md-nav__link">
        Workspace Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Namespaces/" class="md-nav__link">
        Namespaces and Other Objects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Help/" class="md-nav__link">
        Getting Help
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Ufns/" class="md-nav__link">
        User-defined Functions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Operators/" class="md-nav__link">
        Operators
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Quad%20names/" class="md-nav__link">
        Quad Names
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Errors/" class="md-nav__link">
        Error Handling and Debugging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Data/" class="md-nav__link">
        Data IO
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Code/" class="md-nav__link">
        Code IO
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Interfaces/" class="md-nav__link">
        External Interfaces
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Quirks/" class="md-nav__link">
        Historical Quirks
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Interpreter Internals
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Interpreter Internals
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-types" class="md-nav__link">
    Data types
  </a>
  
    <nav class="md-nav" aria-label="Data types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#character" class="md-nav__link">
    Character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#number" class="md-nav__link">
    Number
  </a>
  
    <nav class="md-nav" aria-label="Number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point-representation" class="md-nav__link">
    Floating-point representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison-tolerance" class="md-nav__link">
    Comparison tolerance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-types" class="md-nav__link">
    Value types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-types" class="md-nav__link">
    Reference types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apl-item-hierarchy" class="md-nav__link">
    APL item hierarchy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-parameters" class="md-nav__link">
    Configuration parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-am-i-running" class="md-nav__link">
    What am I running?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
    <nav class="md-nav" aria-label="Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flat-array-techniques" class="md-nav__link">
    Flat array techniques
  </a>
  
    <nav class="md-nav" aria-label="Flat array techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peppery-code" class="md-nav__link">
    Peppery code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-sometimes" class="md-nav__link">
    Loop sometimes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idioms" class="md-nav__link">
    Idioms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#philosophical-tangent" class="md-nav__link">
    Philosophical tangent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Reading/" class="md-nav__link">
        Further Reading
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-types" class="md-nav__link">
    Data types
  </a>
  
    <nav class="md-nav" aria-label="Data types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#character" class="md-nav__link">
    Character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#number" class="md-nav__link">
    Number
  </a>
  
    <nav class="md-nav" aria-label="Number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point-representation" class="md-nav__link">
    Floating-point representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison-tolerance" class="md-nav__link">
    Comparison tolerance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-types" class="md-nav__link">
    Value types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-types" class="md-nav__link">
    Reference types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apl-item-hierarchy" class="md-nav__link">
    APL item hierarchy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-parameters" class="md-nav__link">
    Configuration parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-am-i-running" class="md-nav__link">
    What am I running?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
    <nav class="md-nav" aria-label="Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flat-array-techniques" class="md-nav__link">
    Flat array techniques
  </a>
  
    <nav class="md-nav" aria-label="Flat array techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peppery-code" class="md-nav__link">
    Peppery code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-sometimes" class="md-nav__link">
    Loop sometimes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idioms" class="md-nav__link">
    Idioms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#philosophical-tangent" class="md-nav__link">
    Philosophical tangent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="interpreter-internals">Interpreter Internals</h1>
<p>Just some of the nitty-gritty under the covers.</p>
<h2 id="storage">Storage</h2>
<p>Memory allocated to store an array needs space for:</p>
<ul>
<li>Each element of the array (which could be a reference to another array)</li>
<li><code>8×≢⍴array</code> bytes for the shape (<code>4×</code> in 32-bit)</li>
<li>4 bytes for the type/rank</li>
</ul>
<p>For a reference, the object requires an 8-byte pointer, plus space for the contents of the object.</p>
<h2 id="data-types">Data types</h2>
<p>Internally, Dyalog represents data with the following types. As a program runs, occasionally the interpreter will squeeze arrays into the smallest data type that can represent a particular figure, which helps keep memory usage low and may allow the interpreter to use vectorised instructions for certain operations on certain data types.</p>
<h3 id="character">Character</h3>
<pre><code>      ⎕DR'APL'           ⍝ 1-byte
80
      ⎕DR'配列'           ⍝ 2-byte
160
      ⎕DR⎕←⎕UCS 128077   ⍝ 4-byte
👍
320
</code></pre>
<h3 id="number">Number</h3>
<pre><code>      ⎕DR 1 0 1 0 1 0   ⍝ 1 bit
11
      ⎕DR 42            ⍝ 1 byte
83
      ⎕DR 128           ⍝ 2 byte
163
      ⎕DR 2*15          ⍝ 4 byte
323
      ⎕DR 0J1           ⍝ Complex (2×8 byte double)
1289
</code></pre>
<h4 id="floating-point-representation">Floating-point representation</h4>
<p>There are also 16-byte decimal floating point numbers available, but you need to enable them with <code>⎕FR</code>.</p>
<pre><code>      ⎕PP←34
      ○1
3.141592653589793
      ⎕FR←645    ⍝ 64-bit float (default)
      ○1
3.141592653589793
      ⎕FR←1287   ⍝ 128-bit decimal
      ○1
3.141592653589793238462643383279503
</code></pre>
<h4 id="comparison-tolerance">Comparison tolerance</h4>
<p>APL systems prefer to act like traditional arithmetic where possible. However, the base-2 (binary) representation used by computers is unable to represent certain decimal numbers precisely. Therefore, floating point arithmetic voids certain mathematical properties:</p>
<p><span class="arithmatex">\({{1}\over{3}} = 3 \times {{5}\over{9}} \div 5\)</span></p>
<pre><code class="language-APL">      ⎕CT←1e¯14   ⍝ Default comparison tolerance
      (1÷3)=3×(5÷9)÷5
</code></pre>
<pre><code>1
</code></pre>
<hr />
<pre><code class="language-APL">      ⎕CT←0       ⍝ No comparison tolerance
      (1÷3)=3×(5÷9)÷5
</code></pre>
<pre><code>0
</code></pre>
<hr />
<pre><code class="language-APL">      ⎕FR←645 ⋄ ⎕CT←1E¯14
      {↑⍵(1=1+10*-⍵)}⍳16
</code></pre>
<pre><code>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
0 0 0 0 0 0 0 0 0  0  0  0  0  1  1  1
</code></pre>
<hr />
<pre><code class="language-APL">      ⎕FR←1287 ⋄ ⎕←⎕DCT
</code></pre>
<pre><code>1E¯28
</code></pre>
<hr />
<pre><code class="language-APL">      {↑⍵(1=1+10*-⍵)}⍳30
</code></pre>
<pre><code>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30
0 0 0 0 0 0 0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  1  1
</code></pre>
<p>For exact comparisons set <code>⎕CT</code> to <code>0</code>, but beware:</p>
<pre><code class="language-APL">      10=+/100⍴0.1
</code></pre>
<pre><code>1
</code></pre>
<hr />
<pre><code class="language-APL">      ⎕CT←0
      10=+/100⍴0.1
</code></pre>
<pre><code>0
</code></pre>
<hr />
<pre><code class="language-APL">      10-+/100⍴0.1
</code></pre>
<pre><code>1.953992523E¯14
</code></pre>
<h3 id="value-types">Value types</h3>
<p>If more than one name points to the same array value:</p>
<pre><code>      a←b←1 2 3 4
</code></pre>
<p>then there is a reference count internally, and only one copy of the data is stored in memory.</p>
<p>If one of those arrays is modified:</p>
<pre><code>      b[2]←99
</code></pre>
<p>then a copy of the data is taken at that point so that other arrays are unaffected:</p>
<pre><code>      a b
┌───────┬────────┐
│1 2 3 4│1 99 3 4│
└───────┴────────┘
</code></pre>
<p>For a nested array, however, the elements are separate.</p>
<pre><code>      a←b←(1 2 3)(4 5)
</code></pre>
<p>if one of the elements is modified</p>
<pre><code>      b[⊂2 1]←99
</code></pre>
<p>then the other elements remain shared between names. In this example, the <code>1 2 3</code> array remains shared.</p>
<h3 id="reference-types">Reference types</h3>
<p>While APL arrays are pass-by-value, namespaces and other objects are pass-by-reference.</p>
<pre><code>      nsref←⎕NS⍬
      jsonref←⎕JSON'{}'
      ⎕FIX':Class myclass' ':Endclass'
      ⎕DR¨nsref jsonref myclass
326 326 326
</code></pre>
<p>Although namespaces are pass-by-reference, the references themselves are still values:</p>
<pre><code>      (ns1 ns2)←⎕NS¨2⍴⊂⍬
      (ns1 ns2).var←42 99
      a←ns1
      a.var
42
      a←ns2
      a.var
99
</code></pre>
<h2 id="apl-item-hierarchy">APL item hierarchy</h2>
<p>This useful chart shows what operations are valid for different kinds of items.</p>
<p><img alt="APL item hierarchy" src="../img/APL_Citizens.png" /></p>
<h2 id="configuration-parameters">Configuration parameters</h2>
<p>Many aspects of the interpreter environment can be modified before runtime using <a href="https://help.dyalog.com/latest/index.htm#UserGuide/Installation%20and%20Configuration/Configuration%20Parameters.htm"><strong>configuration parameters</strong></a>. The values of configuration parameters are determined by a hierarchy of scope on the operating system. On Microsoft Windows, these are often registry settings at the base level. On Unix-like systems, they are environment variables.</p>
<p>For example, we can set parameters on the command line in a batch file before starting Dyalog. We can even create custom parameters.</p>
<p><em>Save the following as a .bat file and run it on Windows</em></p>
<pre><code class="language-text">@SET FOO=bar
@START &quot;Dyalog&quot; &quot;C:\Program Files\Dyalog\Dyalog APL-64 18.0 Unicode\dyalog.exe&quot;
</code></pre>
<p>See the value of a configuration parameter with <code>⎕NQ</code>:</p>
<pre><code class="language-APL">      ⎕←2⎕NQ'.' 'GetEnvironment' 'FOO'
</code></pre>
<pre><code>bar
</code></pre>
<p>You might find it useful to read the <a href="http://docs.dyalog.com/17.1/Dyalog%20for%20Microsoft%20Windows%20Installation%20and%20Configuration%20Guide.pdf#%5B%7B%22num%22%3A22%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C63%2C679.5%2C0%5D">Dyalog for Microsoft Windows Installation and Configuration Guide</a> and the <a href="http://docs.dyalog.com/17.1/Dyalog%20for%20UNIX%20Installation%20and%20Configuration%20Guide.pdf#%5B%7B%22num%22%3A21%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C63%2C541.5%2C0%5D">Dyalog for UNIX Installation and Configuration Guide</a>.</p>
<p>Recent versions of Dyalog support universal <a href="https://help.dyalog.com/latest/index.htm#UserGuide/Installation%20and%20Configuration/Configuration%20Files.htm">configuration files</a> which work across all supported platforms.</p>
<h2 id="what-am-i-running">What am I running?</h2>
<p>Here are some useful code snippets for finding information about the currently running interpreter:</p>
<p>What version of Dyalog am I running?</p>
<pre><code class="language-APL">'#'⎕WG'APLVersion'   ⍝ '#' is '.' in older versions of Dyalog
</code></pre>
<p>For error reports, get the BuildID:</p>
<pre><code class="language-APL">⎕←2⎕NQ'#' 'GetBuildID'
</code></pre>
<p>Am I a Unicode interpreter?</p>
<pre><code class="language-APL">80=⎕DR''
</code></pre>
<p>Am I big endian?</p>
<pre><code class="language-APL">⍬⍴83 ⎕DR 256
</code></pre>
<p>What is my word width?</p>
<pre><code class="language-APL">32×1+'4'∊⊃#⎕WG'APLVersion'   ⍝ 64-bit has 64 in the platform name. Otherwise the interpreter is 32-bit.
</code></pre>
<h2 id="performance">Performance</h2>
<p>This course is intended to teach not only the symbols, syntax and system interactions of Dyalog APL, but also to try and teach you <em>the APL way</em>. This is a combination of array-oriented problem solving and ability to combine primitives to solve all manner of problems using computers.</p>
<p>There are some inherent benefits to APL, such as the fact that exploring with APL can often lead you to optimal solutions to particular types of problems. Not only this, but the terseness makes it very easy to experiment and play with different approaches to the same problem.</p>
<p>Besides APL itself, however, there are particular techniques, considerations, and special optimisations within the Dyalog interpreter that you should be aware of in case you find a performance bottleneck in your application and are wondering how to solve it.</p>
<h3 id="flat-array-techniques">Flat array techniques</h3>
<p>Nested arrays are a very convenient construct and can be used to write incredibly elegant expressions for certain operations. For example:</p>
<pre><code class="language-APL">      ≢¨⊆⍨1 1 1 0 1 1 1 1 0 1 1 0 1 1 1 1 0 1 1 1 1
3 4 2 4 4
</code></pre>
<p>However, for long arguments this statement involves allocating many potentially disparate regions of memory and chasing pointers. Try to think of an approach which uses only flat arrays.</p>
<details class="example">
<summary>Answer</summary>
<p>One solution <a href="https://aplcart.info/?q=lengths%20of%20groups%20of%201s#">from APLcart</a>:</p>
<p><pre><code class="language-APL">(0~⍨¯1-2-/∘⍸1,1,⍨~)</code></pre></p>
<p>Of course, for certain arguments simply having more functions can be a performance penalty. Compare <code>]runtime</code> of the two expressions with <code>short←1=?10⍴2</code> and <code>long←1=?1e6⍴2</code></p>
</details>
<h4 id="peppery-code">Peppery code</h4>
<p>One of the <a href="https://en.wikipedia.org/wiki/Code_smell"><strong>code smells</strong></a> in APL is large amounts of code to achieve something relatively simple. This is usually (but not always!) an indication that the problem can be thought of in a different way to achieve a more elegant and efficient solution.</p>
<p>Another code smell is when a solution is littered with the each operator <code>F¨</code> . These are explicit looping operations and often suggest that the code can be re-written to take advantage of the implicit iteration and potential parallelisation of the core primitives acting on flat arrays.</p>
<pre><code class="language-APL">      arg←?5 3⍴10

      ]runtime -c &quot;{⌊0.5+(+⌿÷≢)⍉⍵}arg&quot; &quot;{⌊0.5+(+/⍵)÷⊃⌽⍴⍵}arg&quot; &quot;{⌊0.5+¨(+/¨s)÷c←≢¨s←↓⍵}arg&quot;
</code></pre>
<pre><code>
  {⌊0.5+(+⌿÷≢)⍉⍵}arg         → 1.1E¯6 |   0% ⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕                
  {⌊0.5+(+/⍵)÷⊃⌽⍴⍵}arg       → 8.6E¯7 | -25% ⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕                      
  {⌊0.5+¨(+/¨s)÷c←≢¨s←↓⍵}arg → 1.8E¯6 | +60% ⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕ 
</code></pre>
<h3 id="loop-sometimes">Loop sometimes</h3>
<p>Some types of algorithms really aren't amenable to parallelisation and array-oriented techniques. These are usually problems with heavy dependence on intermediate results. Sometimes they can be encoded in a custom scan or reduction, but the overall algorithm isn't able to take advantage of parallelisation that primitive scans and reductions can.</p>
<p>Another consideration is that sometimes an elegant-looking solution in APL is quite inefficient. Take the prime number filter we saw early on:</p>
<pre><code class="language-APL">Primes ← {⍸2=+⌿0=∘.|⍨⍳⍵}</code></pre>

<p>An alternative coding uses the multiplication table:</p>
<pre><code class="language-APL">Primes ← {i~∘.×⍨i←1↓⍳⍵}</code></pre>

<p>Of course, the outer product <code>∘.F</code> indicates that the number of calculations to compute both of these solutions increases with the square of the input size. We say they have a computational complexity "<em>of order n squared</em>" or <span class="arithmatex">\(O(n^2)\)</span> in <a href="https://en.wikipedia.org/wiki/Big_O_notation">big-O notation</a>. This is a very inefficient way to find prime numbers.</p>
<p>To see discussions around more efficient ways to compute prime numbers in APL, see <a href="https://dfns.dyalog.com/n_pco.htm">the dfns page on prime numbers</a>.</p>
<p>Put simply, the fastest algorithm in general is the one which performs the fewest computations. Sometimes there are solutions in APL which use a relatively large amount of memory but are fast in time due to optimised primitives. However, sometimes the domain of the problem grows so large that even these solutions are outperformed by a scalar looping solution. When this is the case, if performance is very important for this part of your application, it can be a good idea to search for pre-existing high performance solutions, or to write the solution in a lower level language, and use <code>⎕NA</code> to integrate it with your APL code.</p>
<ol>
<li>Try to find an optimised expression which uses the rank operator <code>F⍤k</code>.</li>
<li>What is the computational complexity of a custom reduction <code>F/⍵</code>?</li>
<li>What is the computational complexity of a custom scan?</li>
<li>How do custom scans and reductions compare with primitive scans and reductions for <code>+ - × ÷</code>?</li>
</ol>
<h3 id="idioms">Idioms</h3>
<p>APL idioms are short expressions to perform certain tasks. <a href="https://aplcart.info">APLcart</a> is a comprehensive, searchable list of idioms. Some of these include slightly obscure but performant versions of particular tasks, especially those related to <a href="https://aplcart.info/?q=partitioned#">partitioned functions</a>.</p>
<p>In Dyalog APL, there are also "idioms" which are specially recognised phrases, or combinations of characters, which are treated as individual tokens and executed with special code, rather than parsed symbol-by-symbol and executed function-at-a-time. These offer significant performance improvements for particular tasks, and are all listed:</p>
<ul>
<li><a href="https://docs.dyalog.com/latest/CheatSheet%20-%20Idioms.pdf">latest</a></li>
<li><a href="https://docs.dyalog.com/17.1/CheatSheet%20-%20Idioms.pdf">17.1</a></li>
<li><a href="https://help.dyalog.com/12.1/index.html?page=html%2Fidiom%20list.htm">12.1</a></li>
</ul>
<h3 id="philosophical-tangent">Philosophical tangent</h3>
<p>In an ideal world, programmers could focus on writing purely the "most readable" or "most maintainable" versions of their code. Or, in some sense, simply write "whatever feels right" and the interpreter or compiler could analyse the program and determine the optimal. This is part of what compilers hope to achieve. However, even in one the strongest attempts at this so far, Julia, they emphasise that you still need to learn to write "idiomatic Julia" code. This means understanding how the language works both in terms of semantics and which constructs can be written in a particular way to lead to high performance.</p>
<p>In Dyalog APL, one example of this is in the primitive operators.</p>
<p>The key operator <code>F⌸</code> applies its operand function <code>F</code> to grouped major cells of its argument array. An alternative approach is to have a function <code>{⊂⍵}⌸</code> perform the grouping first and then to apply using each <code>F¨{⊂⍵}⌸</code> . The end result of the computation is the same, but by having an operator, the interpreter implementors can use especially efficient special code for certain operand functions.</p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../Quirks/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Historical Quirks" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Historical Quirks
            </div>
          </div>
        </a>
      
      
        
        <a href="../Reading/" class="md-footer__link md-footer__link--next" aria-label="Next: Further Reading" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Further Reading
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>