
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A guided introduction to Dyalog APL">
      
      
      
        <link rel="canonical" href="https://dyalog.com/Interpreter-internals/">
      
      
        <link rel="prev" href="../Quirks/">
      
      
        <link rel="next" href="../Reading/">
      
      
      <link rel="icon" href="../img/favicon-32.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Interpreter Internals - APL Course</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../style/main.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#interpreter-internals" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="APL Course" class="md-header__button md-logo" aria-label="APL Course" data-md-component="logo">
      
  <img src="../img/dyalog-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            APL Course
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Interpreter Internals
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="APL Course" class="md-nav__button md-logo" aria-label="APL Course" data-md-component="logo">
      
  <img src="../img/dyalog-white.svg" alt="logo">

    </a>
    APL Course
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic-syntax-and-arithmetic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic syntax
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dfns-and-assignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dfns and Assignment
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../array-logic-data-driven-conditionals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Array Logic and Data-driven Conditionals
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multidimensional-and-nested-arrays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multidimensional and Nested Arrays
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cells-and-axes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cells and Axes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../finding-and-replacing-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Finding and Replacing Values
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../selecting-from-arrays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Selecting from Arrays
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../broken-keyboard-problems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Broken Keyboard Problems
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../loops-and-recursion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Loops and Recursion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Assignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extra Assignment
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Workspaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workspace Basics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Namespaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespaces and Other Objects
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Help
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-defined-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User-defined Functions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Operators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operators
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Quad%20names/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quad Names
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../error-handling-and-debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling and Debugging
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data IO
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code IO
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Interfaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External Interfaces
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Quirks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Historical Quirks
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Interpreter Internals
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Interpreter Internals
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-types" class="md-nav__link">
    <span class="md-ellipsis">
      Data types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#character" class="md-nav__link">
    <span class="md-ellipsis">
      Character
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#number" class="md-nav__link">
    <span class="md-ellipsis">
      Number
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point-representation" class="md-nav__link">
    <span class="md-ellipsis">
      Floating-point representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison-tolerance" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison tolerance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-types" class="md-nav__link">
    <span class="md-ellipsis">
      Value types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-types" class="md-nav__link">
    <span class="md-ellipsis">
      Reference types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-am-i-running" class="md-nav__link">
    <span class="md-ellipsis">
      What am I running?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    <span class="md-ellipsis">
      Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flat-array-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Flat array techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flat array techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peppery-code" class="md-nav__link">
    <span class="md-ellipsis">
      Peppery code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-sometimes" class="md-nav__link">
    <span class="md-ellipsis">
      Loop sometimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idioms" class="md-nav__link">
    <span class="md-ellipsis">
      Idioms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#philosophical-tangent" class="md-nav__link">
    <span class="md-ellipsis">
      Philosophical tangent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Reading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Further Reading
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-types" class="md-nav__link">
    <span class="md-ellipsis">
      Data types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#character" class="md-nav__link">
    <span class="md-ellipsis">
      Character
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#number" class="md-nav__link">
    <span class="md-ellipsis">
      Number
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#floating-point-representation" class="md-nav__link">
    <span class="md-ellipsis">
      Floating-point representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparison-tolerance" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison tolerance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-types" class="md-nav__link">
    <span class="md-ellipsis">
      Value types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-types" class="md-nav__link">
    <span class="md-ellipsis">
      Reference types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-am-i-running" class="md-nav__link">
    <span class="md-ellipsis">
      What am I running?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    <span class="md-ellipsis">
      Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flat-array-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Flat array techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flat array techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peppery-code" class="md-nav__link">
    <span class="md-ellipsis">
      Peppery code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-sometimes" class="md-nav__link">
    <span class="md-ellipsis">
      Loop sometimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idioms" class="md-nav__link">
    <span class="md-ellipsis">
      Idioms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#philosophical-tangent" class="md-nav__link">
    <span class="md-ellipsis">
      Philosophical tangent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="interpreter-internals">Interpreter Internals</h1>
<p>Just some of the nitty-gritty under the covers.</p>
<h2 id="storage">Storage</h2>
<p>Memory allocated to store an array needs space for:</p>
<ul>
<li>Each element of the array (which could be a reference to another array)</li>
<li><code>8Ã—â‰¢â´array</code> bytes for the shape (<code>4Ã—</code> in 32-bit)</li>
<li>4 bytes for the type/rank</li>
</ul>
<p>For a reference, the object requires an 8-byte pointer, plus space for the contents of the object.</p>
<h2 id="data-types">Data types</h2>
<p>Internally, Dyalog represents data with the following types. As a program runs, occasionally the interpreter will squeeze arrays into the smallest data type that can represent a particular figure, which helps keep memory usage low and may allow the interpreter to use vectorised instructions for certain operations on certain data types.</p>
<h3 id="character">Character</h3>
<pre class="highlight"><code>      â•DR'APL'           â 1-byte
80
      â•DR'é…åˆ—'           â 2-byte
160
      â•DRâ•â†â•UCS 128077   â 4-byte
ğŸ‘
320</code></pre>
<h3 id="number">Number</h3>
<pre class="highlight"><code>      â•DR 1 0 1 0 1 0   â 1 bit
11
      â•DR 42            â 1 byte
83
      â•DR 128           â 2 byte
163
      â•DR 2*15          â 4 byte
323
      â•DR 0J1           â Complex (2Ã—8 byte double)
1289</code></pre>
<h4 id="floating-point-representation">Floating-point representation</h4>
<p>There are also 16-byte decimal floating point numbers available, but you need to enable them with <code>â•FR</code>.</p>
<pre class="highlight"><code>      â•PPâ†34
      â—‹1
3.141592653589793
      â•FRâ†645    â 64-bit float (default)
      â—‹1
3.141592653589793
      â•FRâ†1287   â 128-bit decimal
      â—‹1
3.141592653589793238462643383279503</code></pre>
<h4 id="comparison-tolerance">Comparison tolerance</h4>
<p>APL systems prefer to act like traditional arithmetic where possible. However, the base-2 (binary) representation used by computers is unable to represent certain decimal numbers precisely. Therefore, floating point arithmetic voids certain mathematical properties:</p>
<p><span class="arithmatex">\({{1}\over{3}} = 3 \times {{5}\over{9}} \div 5\)</span></p>
<p><pre class="highlight"><code class="language-APL">      â•CTâ†1eÂ¯14   â Default comparison tolerance
      (1Ã·3)=3Ã—(5Ã·9)Ã·5</code></pre>
<pre class="highlight"><code>1</code></pre></p>
<hr />
<p><pre class="highlight"><code class="language-APL">      â•CTâ†0       â No comparison tolerance
      (1Ã·3)=3Ã—(5Ã·9)Ã·5</code></pre>
<pre class="highlight"><code>0</code></pre></p>
<hr />
<p><pre class="highlight"><code class="language-APL">      â•FRâ†645 â‹„ â•CTâ†1EÂ¯14
      {â†‘âµ(1=1+10*-âµ)}â³16</code></pre>
<pre class="highlight"><code>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
0 0 0 0 0 0 0 0 0  0  0  0  0  1  1  1</code></pre></p>
<hr />
<p><pre class="highlight"><code class="language-APL">      â•FRâ†1287 â‹„ â•â†â•DCT</code></pre>
<pre class="highlight"><code>1EÂ¯28</code></pre></p>
<hr />
<p><pre class="highlight"><code class="language-APL">      {â†‘âµ(1=1+10*-âµ)}â³30</code></pre>
<pre class="highlight"><code>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30
0 0 0 0 0 0 0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  1  1</code></pre></p>
<p>For exact comparisons set <code>â•CT</code> to <code>0</code>, but beware:</p>
<p><pre class="highlight"><code class="language-APL">      10=+/100â´0.1</code></pre>
<pre class="highlight"><code>1</code></pre></p>
<hr />
<p><pre class="highlight"><code class="language-APL">      â•CTâ†0
      10=+/100â´0.1</code></pre>
<pre class="highlight"><code>0</code></pre></p>
<hr />
<p><pre class="highlight"><code class="language-APL">      10-+/100â´0.1</code></pre>
<pre class="highlight"><code>1.953992523EÂ¯14</code></pre></p>
<h3 id="value-types">Value types</h3>
<p>If more than one name points to the same array value:
<pre class="highlight"><code>      aâ†bâ†1 2 3 4</code></pre>
then there is a reference count internally, and only one copy of the data is stored in memory.</p>
<p>If one of those arrays is modified:
<pre class="highlight"><code>      b[2]â†99</code></pre>
then a copy of the data is taken at that point so that other arrays are unaffected:
<pre class="highlight"><code>      a b
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚1 2 3 4â”‚1 99 3 4â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></p>
<p>For a nested array, however, the elements are separate.
<pre class="highlight"><code>      aâ†bâ†(1 2 3)(4 5)</code></pre>
if one of the elements is modified
<pre class="highlight"><code>      b[âŠ‚2 1]â†99</code></pre>
then the other elements remain shared between names. In this example, the <code>1 2 3</code> array remains shared.</p>
<h3 id="reference-types">Reference types</h3>
<p>While APL arrays are pass-by-value, namespaces and other objects are pass-by-reference.</p>
<pre class="highlight"><code>      nsrefâ†â•NSâ¬
      jsonrefâ†â•JSON'{}'
      â•FIX':Class myclass' ':Endclass'
      â•DRÂ¨nsref jsonref myclass
326 326 326</code></pre>
<p>Although namespaces are pass-by-reference, the references themselves are still values:
<pre class="highlight"><code>      (ns1 ns2)â†â•NSÂ¨2â´âŠ‚â¬
      (ns1 ns2).varâ†42 99
      aâ†ns1
      a.var
42
      aâ†ns2
      a.var
99</code></pre></p>
<h2 id="configuration-parameters">Configuration parameters</h2>
<p>Many aspects of the interpreter environment can be modified before runtime using <a href="https://help.dyalog.com/latest/index.htm#UserGuide/Installation%20and%20Configuration/Configuration%20Parameters.htm"><strong>configuration parameters</strong></a>. The values of configuration parameters are determined by a hierarchy of scope on the operating system. On Microsoft Windows, these are often registry settings at the base level. On Unix-like systems, they are environment variables.</p>
<p>For example, we can set parameters on the command line in a batch file before starting Dyalog. We can even create custom parameters.</p>
<p><em>Save the following as a .bat file and run it on Windows</em></p>
<pre class="highlight"><code class="language-text">@SET FOO=bar
@START "Dyalog" "C:\Program Files\Dyalog\Dyalog APL-64 18.0 Unicode\dyalog.exe"</code></pre>
<p>See the value of a configuration parameter with <code>â•NQ</code>:</p>
<p><pre class="highlight"><code class="language-APL">      â•â†2â•NQ'.' 'GetEnvironment' 'FOO'</code></pre>
<pre class="highlight"><code>bar</code></pre></p>
<p>You might find it useful to read the <a href="http://docs.dyalog.com/17.1/Dyalog%20for%20Microsoft%20Windows%20Installation%20and%20Configuration%20Guide.pdf#%5B%7B%22num%22%3A22%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C63%2C679.5%2C0%5D">Dyalog for Microsoft Windows Installation and Configuration Guide</a> and the <a href="http://docs.dyalog.com/17.1/Dyalog%20for%20UNIX%20Installation%20and%20Configuration%20Guide.pdf#%5B%7B%22num%22%3A21%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C63%2C541.5%2C0%5D">Dyalog for UNIX Installation and Configuration Guide</a>.</p>
<p>Recent versions of Dyalog support universal <a href="https://help.dyalog.com/latest/index.htm#UserGuide/Installation%20and%20Configuration/Configuration%20Files.htm">configuration files</a> which work across all supported platforms.</p>
<h2 id="what-am-i-running">What am I running?</h2>
<p>Here are some useful code snippets for finding information about the currently running interpreter:</p>
<p>What version of Dyalog am I running?</p>
<pre class="highlight"><code class="language-APL">'#'â•WG'APLVersion'   â '#' is '.' in older versions of Dyalog</code></pre>
<p>For error reports, get the BuildID:</p>
<pre class="highlight"><code class="language-APL">â•â†2â•NQ'#' 'GetBuildID'</code></pre>
<p>Am I a Unicode interpreter?</p>
<pre class="highlight"><code class="language-APL">80=â•DR''</code></pre>
<p>Am I big endian?</p>
<pre class="highlight"><code class="language-APL">â¬â´83 â•DR 256</code></pre>
<p>What is my word width?</p>
<pre class="highlight"><code class="language-APL">32Ã—1+'4'âˆŠâŠƒ#â•WG'APLVersion'   â 64-bit has 64 in the platform name. Otherwise the interpreter is 32-bit.</code></pre>
<h2 id="performance">Performance</h2>
<p>This course is intended to teach not only the symbols, syntax and system interactions of Dyalog APL, but also to try and teach you <em>the APL way</em>. This is a combination of array-oriented problem solving and ability to combine primitives to solve all manner of problems using computers.</p>
<p>There are some inherent benefits to APL, such as the fact that exploring with APL can often lead you to optimal solutions to particular types of problems. Not only this, but the terseness makes it very easy to experiment and play with different approaches to the same problem.</p>
<p>Besides APL itself, however, there are particular techniques, considerations, and special optimisations within the Dyalog interpreter that you should be aware of in case you find a performance bottleneck in your application and are wondering how to solve it.</p>
<h3 id="flat-array-techniques">Flat array techniques</h3>
<p>Nested arrays are a very convenient construct and can be used to write incredibly elegant expressions for certain operations. For example:</p>
<pre class="highlight"><code class="language-APL">      â‰¢Â¨âŠ†â¨1 1 1 0 1 1 1 1 0 1 1 0 1 1 1 1 0 1 1 1 1
3 4 2 4 4</code></pre>
<p>However, for long arguments this statement involves allocating many potentially disparate regions of memory and chasing pointers. Try to think of an approach which uses only flat arrays.</p>
<details class="example">
<summary>Answer</summary>
<p>One solution <a href="https://aplcart.info/?q=lengths%20of%20groups%20of%201s#">from APLcart</a>:</p>
<p><pre><code class="language-APL">(0~â¨Â¯1-2-/âˆ˜â¸1,1,â¨~)</code></pre></p>
<p>Of course, for certain arguments simply having more functions can be a performance penalty. Compare <code>]runtime</code> of the two expressions with <code>shortâ†1=?10â´2</code> and <code>longâ†1=?1e6â´2</code></p>
</details>
<h4 id="peppery-code">Peppery code</h4>
<p>One of the <a href="https://en.wikipedia.org/wiki/Code_smell"><strong>code smells</strong></a> in APL is large amounts of code to achieve something relatively simple. This is usually (but not always!) an indication that the problem can be thought of in a different way to achieve a more elegant and efficient solution.</p>
<p>Another code smell is when a solution is littered with the each operator <code>FÂ¨</code> . These are explicit looping operations and often suggest that the code can be re-written to take advantage of the implicit iteration and potential parallelisation of the core primitives acting on flat arrays.</p>
<p><pre class="highlight"><code class="language-APL">      argâ†?5 3â´10

      ]runtime -c "{âŒŠ0.5+(+âŒ¿Ã·â‰¢)â‰âµ}arg" "{âŒŠ0.5+(+/âµ)Ã·âŠƒâŒ½â´âµ}arg" "{âŒŠ0.5+Â¨(+/Â¨s)Ã·câ†â‰¢Â¨sâ†â†“âµ}arg"</code></pre>
<pre class="highlight"><code>
  {âŒŠ0.5+(+âŒ¿Ã·â‰¢)â‰âµ}arg         â†’ 1.1EÂ¯6 |   0% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                
  {âŒŠ0.5+(+/âµ)Ã·âŠƒâŒ½â´âµ}arg       â†’ 8.6EÂ¯7 | -25% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                      
  {âŒŠ0.5+Â¨(+/Â¨s)Ã·câ†â‰¢Â¨sâ†â†“âµ}arg â†’ 1.8EÂ¯6 | +60% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• </code></pre></p>
<h3 id="loop-sometimes">Loop sometimes</h3>
<p>Some types of algorithms really aren't amenable to parallelisation and array-oriented techniques. These are usually problems with heavy dependence on intermediate results. Sometimes they can be encoded in a custom scan or reduction, but the overall algorithm isn't able to take advantage of parallelisation that primitive scans and reductions can.</p>
<p>Another consideration is that sometimes an elegant-looking solution in APL is quite inefficient. Take the prime number filter we saw early on:</p>
<pre><code class="language-APL">Primes â† {â¸2=+âŒ¿0=âˆ˜.|â¨â³âµ}</code></pre>

<p>An alternative coding uses the multiplication table:</p>
<pre><code class="language-APL">Primes â† {i~âˆ˜.Ã—â¨iâ†1â†“â³âµ}</code></pre>

<p>Of course, the outer product <code>âˆ˜.F</code> indicates that the number of calculations to compute both of these solutions increases with the square of the input size. We say they have a computational complexity "<em>of order n squared</em>" or <span class="arithmatex">\(O(n^2)\)</span> in <a href="https://en.wikipedia.org/wiki/Big_O_notation">big-O notation</a>. This is a very inefficient way to find prime numbers.</p>
<p>To see discussions around more efficient ways to compute prime numbers in APL, see <a href="https://dfns.dyalog.com/n_pco.htm">the dfns page on prime numbers</a>.</p>
<p>Put simply, the fastest algorithm in general is the one which performs the fewest computations. Sometimes there are solutions in APL which use a relatively large amount of memory but are fast in time due to optimised primitives. However, sometimes the domain of the problem grows so large that even these solutions are outperformed by a scalar looping solution. When this is the case, if performance is very important for this part of your application, it can be a good idea to search for pre-existing high performance solutions, or to write the solution in a lower level language, and use <code>â•NA</code> to integrate it with your APL code.</p>
<ol>
<li>Try to find an optimised expression which uses the rank operator <code>Fâ¤k</code>.</li>
<li>What is the computational complexity of a custom reduction <code>F/âµ</code>?</li>
<li>What is the computational complexity of a custom scan?</li>
<li>How do custom scans and reductions compare with primitive scans and reductions for <code>+ - Ã— Ã·</code>?</li>
</ol>
<h3 id="idioms">Idioms</h3>
<p>APL idioms are short expressions to perform certain tasks. <a href="https://aplcart.info">APLcart</a> is a comprehensive, searchable list of idioms. Some of these include slightly obscure but performant versions of particular tasks, especially those related to <a href="https://aplcart.info/?q=partitioned#">partitioned functions</a>.</p>
<p>In Dyalog APL, there are also "idioms" which are specially recognised phrases, or combinations of characters, which are treated as individual tokens and executed with special code, rather than parsed symbol-by-symbol and executed function-at-a-time. These offer significant performance improvements for particular tasks, and are all listed:</p>
<ul>
<li><a href="https://docs.dyalog.com/latest/CheatSheet%20-%20Idioms.pdf">latest</a></li>
<li><a href="https://docs.dyalog.com/17.1/CheatSheet%20-%20Idioms.pdf">17.1</a></li>
<li><a href="https://help.dyalog.com/12.1/index.html?page=html%2Fidiom%20list.htm">12.1</a></li>
</ul>
<h3 id="philosophical-tangent">Philosophical tangent</h3>
<p>In an ideal world, programmers could focus on writing purely the "most readable" or "most maintainable" versions of their code. Or, in some sense, simply write "whatever feels right" and the interpreter or compiler could analyse the program and determine the optimal. This is part of what compilers hope to achieve. However, even in one the strongest attempts at this so far, Julia, they emphasise that you still need to learn to write "idiomatic Julia" code. This means understanding how the language works both in terms of semantics and which constructs can be written in a particular way to lead to high performance.</p>
<p>In Dyalog APL, one example of this is in the primitive operators.</p>
<p>The key operator <code>FâŒ¸</code> applies its operand function <code>F</code> to grouped major cells of its argument array. An alternative approach is to have a function <code>{âŠ‚âµ}âŒ¸</code> perform the grouping first and then to apply using each <code>FÂ¨{âŠ‚âµ}âŒ¸</code> . The end result of the computation is the same, but by having an operator, the interpreter implementors can use especially efficient special code for certain operand functions.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://dyalog.com" target="_blank" rel="noopener" title="dyalog.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M16 32v119.2h64V96h107.2C300.6 96 368 176.2 368 255.9 368 332 309.4 416 187.2 416H16v64h171.2C347.9 480 432 367.3 432 255.9c0-58.7-22.1-113.4-62.3-154.3C324.9 56 261.7 32 187.2 32z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://mastodon.social/@dyalog" target="_blank" rel="noopener" title="mastodon.social" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 15.5a.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5v-7c0-1.93-2.07-3.5-4-3.5H6a4 4 0 0 0-4 4v10h4v-4h5v4h4v-4.5a.5.5 0 0 1 .5-.5.5.5 0 0 1 .5.5V16a3 3 0 0 0 3 3 3 3 0 0 0 3-3v-2h-2.5z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/dyalogapl" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "content.tooltips"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="../javascripts/mathjax/tex-mml-chtml.js"></script>
      
    
  </body>
</html>